<!DOCTYPE html>
<html>
    <head>
        <title>
        </title>
        <style>
            body{
                background-color:#E2EAF3;
            }
            h3{
                font-family: Arial, Helvetica, sans-serif;
                color: white;
                background-color: #2F73FE;
                padding: 10px;
                align-items: center;
                border-style: solid;
                border-radius: 5px;
                border-width:8px;
                border-color: #1f255ee5;
                position: sticky;
                top: 0;
                z-index: 999;
                overflow: hidden;
            }
            
            .container{
                background-color: #1f255ee5;
                color: white;
                height: fit-content;
                border-radius: 5px;
                padding: 10px;
            }
            h4{
                font-family: Arial, Helvetica, sans-serif;
                color: white;
                background-color: #2F73FE;
                padding: 10px;
                align-items: center;
                border-radius: 20px;
            }
            .mainbuttom{
                background-color: #E2EAF3; 
                border: none;
                color: black;
                padding: 10px 30px;
                text-align: center;
                text-decoration: none;
                display: inline-block;
                font-size: 16px;
                margin: 4px 2px;
                cursor: pointer;
                position:relative;
                box-shadow: 0 12px 16px 0 rgba(0,0,0,0.24), 0 17px 50px 0 rgba(0,0,0,0.19);
                border-radius: 15px;
            }
            b{
                font-family: Arial, Helvetica, sans-serif;
                color: black;
                background-color: #B3F0FE;
                padding: 5px;
                align-items: center;
                border-radius: 5px;
            }
        </style>
    </head>

    <body>
    <h3><img src="./image/weather.png" width='30' height='30'>            WEATHER天氣預報&nbsp&nbsp&nbsp&nbsp<input class="mainbuttom" type ="button" style="float: right;" onclick="javascript:location.href='https://jemmy9211.github.io/'" value="回到 jemmy 首頁"></input></br></br>未來7天 天氣(資料來自中央氣象局API 每日更新)</h3>
    <canvas id="myChart" style="width:100%;max-width:1200px"></canvas>
    <div class="container" ><h4>文字預報</h4></div>
    <br><b>2023/4/9 design by jemmy &nbsp&nbsp&nbsp Email:jemmy9211@gmail.com</b>
    </body>
    <script src="https://code.jquery.com/jquery-3.4.1.js" integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.9.4/Chart.js"></script>
    <script>
        $.ajax({
            url:'https://opendata.cwb.gov.tw/api/v1/rest/datastore/F-D0047-091?Authorization=CWB-373C6328-6BF2-41B3-BB3B-147802B82875&format=JSON&locationName=&elementName=&sort=time',
            method: "GET",
            datatype:"json",
            success: function(res){
                console.log(res);
                data = res.records.locations[0].location[6].weatherElement;
                console.log(data);
                updateweather();
                charting();
            }
        });
        
        var xValues=[];
        var yValues=[];
        function updateweather(){
            var inner=document.querySelector('.container');
            for(var i=0;i<=data[1].time.length-1;i++){
                var weatherdata=data[1].time[i];
                console.log(data[1].time.length);
                var weatherdescription=data[10].time[i];
                var weatherimg="";
                if(weatherdescription.elementValue[0].value.indexOf("晴時多雲")!=-1){
                    weatherimg="cloudy.png";
                }else if(weatherdescription.elementValue[0].value.indexOf("多雲")!=-1){
                    weatherimg="cloud.png";
                }else if(weatherdescription.elementValue[0].value.indexOf("晴天")!=-1){
                    weatherimg="sun.png";
                }else if(weatherdescription.elementValue[0].value.indexOf("多雲時晴")!=-1){
                    weatherimg="cloudy(1).png";
                }else{
                    weatherimg="raining.png";
                }
                yValues.push(weatherdata.elementValue[0].value);
                xValues.push(weatherdata.startTime.substr(8, 5)+" to "+weatherdata.endTime.substr(8, 5));
                inner.innerHTML+="<b>日期:"+weatherdata.startTime+" to "+weatherdata.endTime+" 氣溫:"+weatherdata.elementValue[0].value+"</b><br><b>簡短描述:</b> "+ weatherdescription.elementValue[0].value+"<img src='./image/"+ weatherimg+"' width='30' height='30'></br></br>";
            }
            
        };
        
        function charting(){
            new Chart("myChart", {
                type: "line",
                data: {
                    labels: xValues,
                    datasets: [{
                        label: '平均溫度:',
                        fill: false,
                        lineTension: 0.5,
                        backgroundColor: "rgba(235, 40, 48, 0.8)",
                        borderColor: "rgba(39, 116, 245, 0.91)",
                        data: yValues,
                        pointStyle: 'circle',
                        pointRadius: 10,
                        pointHoverRadius: 15
                    }]
                },
                options: {
                    legend: {display: true},
                    scales: {
                    yAxes: [{ticks: {min: 10, max:35}}],
                    }
                }
            });
        };
        
    </script>
</html>